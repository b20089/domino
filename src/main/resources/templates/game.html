<!DOCTYPE html>
<html>

<head>
  <script src="\jQuery\jquery-3.6.3.min.js"></script>
  <link rel="stylesheet">
  <script th:inline="javascript">
    var num = 1;
    var num2 = 1;
    var alertStr2 = /*[[${room}]]*/
      function test1() {
        alert(alertStr2.id);
      }
    var alertStr3 = /*[[${roomid}]]*/
      function test2() {
        alert(alertStr3);
      }
    var test = function(){
      const link = /*[[@{/dominoKnock(id=${room.id}, userid=${user.id})}]]*/'';
      $('div.Fall_Down').html('<a href="' + link + '">満足した</a>');
    }
    window.onload = function () {
      var sse1 = new EventSource('/intoRoom?test=' + alertStr3);
      var buffer = 0;
      var ele = document.getElementById('e');
      var childEle = document.createElement('childEle');
      ele.appendChild(childEle);
      sse1.onmessage = function (event) {
        console.log(event.data);
        var room = event.data[0];
        var q = 0;
        var f = 0;
        var f2 = 0;
        var a = '';
        var b = '';
        var c = '';
        var i = 0;
        while (i != 150) {
          i++;

          console.log(event.data[i]);
          if (event.data[i] == '}') {
            f = 0;
            f2++;
          }

          if (f == 1 && f2 == 0) {
            a += event.data[i];
            q = 0;
          }
          if (f == 1 && f2 == 1) {
            b += event.data[i];
            q = 0;
          }
          if (f == 1 && f2 == 2) {
            c += event.data[i];
            q = 0;
          }

          if (event.data[i] == '"' || event.data[i] == ':') {
            q++;
            if (q == 9) {
              f++;
            }

          }
        }
        document.getElementById("a").textContent = a;
        document.getElementById("b").textContent = b;
        document.getElementById("c").textContent = c;
        console.log(a);
        num = a;
        console.log(num + "to" + num2 );
        num2 = a;
        //ele.removeChild(childEle);
        childEle.remove();
        childEle = document.createElement('childEle');
        ele.appendChild(childEle);
        for (var i = 0; i < a; i++) {
          childEle.insertAdjacentHTML('beforeend', '<img class="img" src="/img/domino_daoshi2.png" alt="picture" width="42.5" height="101" class=example' + a + '>');
        }
        buffer = a;
        console.log(buffer + "画像の数");
      }
    }
    var q = 0;
    var f = 0;
    for (var i = 0; event.data[i] == '\0'; i++) {

      if (event.data[i] == '}') {
        f = 0;
      }

      if (f == 1) {
        a += event.data[i];
        q = 0;
      }

      if (event.data[i] == '"' || event.data[i] == ':') {
        q++;
        if (q == 9) {
          f++;
        }

      }

    }
  </script>
</head>

<body>
  
  <a th:href="@{/back(userid=${user.id})}">もどる</a><br>

  <div th:if="${room}">
    <p>No.[[${room.id}]]</a></p>
  </div>
  <input type="button" value="Room.id," onclick="test1();" />
  <input type="button" value="RoomNo2," onclick="test2();" />

  <div th:if="${user}">
    あなたのID:[[${user.id}]]
    <div th:if="${count}">
      部屋の人数:[[${count}]]
    </div>
    <div th:if="${room}">
      RoomNo.1のドミノ数:<a id="a"></a><br>
      RoomNo.2のドミノ数:<a id="b"></a><br>
      RoomNo.3のドミノ数:<a id="c"></a>
    </div>
  </div>

  <a th:href="@{/dominoSet(id=${room.id}, userid=${user.id})}">ドミノを設置</a><br>
  <div class="Fall_Down">
    <input type="button" value="ドミノを倒す" onclick="test()">
  </div>
  <br>
  <div id="e"></div>

  <br>
  <div th:if="${player}">
    <div th:each="play:${player}">
      <tr>
        <td>[[${play.id}]]がドミノを置いた</td>
      </tr>
    </div>
  </div>

</body>

</html>
